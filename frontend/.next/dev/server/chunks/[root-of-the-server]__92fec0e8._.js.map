{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ameli/Documents/studia/projekt/ShareWay/frontend/lib/prebakedQueries.ts"],"sourcesContent":["//import prebakedQueries from \"@/data/prebakedQueries.json\";\r\n//import prebakedQueriesExtra from \"@/data/prebakedQueriesExtra.json\";\r\n\r\nconst map = new Map<string, string[]>();\r\n\r\nfunction normalize(text: string) {\r\n  return text\r\n    .normalize(\"NFD\")\r\n    .replace(/[\\u0300-\\u036f]/g, \"\")\r\n    .toLowerCase();\r\n}\r\n\r\nlet prebakedQueries: Record<string, unknown> = {};\r\nlet prebakedQueriesExtra: Record<string, unknown> = {};\r\n\r\n// Załaduj pliki bezpiecznie - jeśli nie istnieją, nie przerywa aplikacji\r\ntry {\r\n  prebakedQueries = require(\"@/data/prebakedQueries.json\");\r\n} catch (error) {\r\n  console.warn(\"prebakedQueries.json not found, using empty object\");\r\n}\r\n\r\ntry {\r\n  prebakedQueriesExtra = require(\"@/data/prebakedQueriesExtra.json\");\r\n} catch (error) {\r\n  console.warn(\"prebakedQueriesExtra.json not found, using empty object\");\r\n}\r\n\r\nconst sources = [prebakedQueries, prebakedQueriesExtra];\r\n\r\nfor (const source of sources) {\r\n  try {\r\n    for (const [key, value] of Object.entries(source)) {\r\n      const norm = normalize(key).trim();\r\n      if (!norm) continue;\r\n      if (Array.isArray(value)) {\r\n        const asStrings = value\r\n          .map((item) => {\r\n            if (typeof item === \"string\") return item;\r\n            if (item && typeof item === \"object\" && \"query\" in item) {\r\n              const query = (item as { query?: unknown }).query;\r\n              return typeof query === \"string\" ? query : null;\r\n            }\r\n            return null;\r\n          })\r\n          .filter((v): v is string => !!v);\r\n\r\n        const unique = Array.from(new Set(asStrings));\r\n        if (unique.length) map.set(norm, unique);\r\n      }\r\n    }\r\n  } catch (error) {\r\n    console.warn(\"Error processing prebaked queries:\", error);\r\n  }\r\n}\r\n\r\nexport function getPrebakedQueries(destination: string) {\r\n  try {\r\n    const norm = normalize(destination).trim();\r\n    if (!norm) return [];\r\n    return map.get(norm) ?? [];\r\n  } catch (error) {\r\n    console.warn(\"Error getting prebaked queries:\", error);\r\n    return [];\r\n  }\r\n}\r\n"],"names":[],"mappings":"AAAA,4DAA4D;AAC5D,sEAAsE;;;;;AAEtE,MAAM,MAAM,IAAI;AAEhB,SAAS,UAAU,IAAY;IAC7B,OAAO,KACJ,SAAS,CAAC,OACV,OAAO,CAAC,oBAAoB,IAC5B,WAAW;AAChB;AAEA,IAAI,kBAA2C,CAAC;AAChD,IAAI,uBAAgD,CAAC;AAErD,yEAAyE;AACzE,IAAI;IACF;;;;;AACF,EAAE,OAAO,OAAO;IACd,QAAQ,IAAI,CAAC;AACf;AAEA,IAAI;IACF;;;;;AACF,EAAE,OAAO,OAAO;IACd,QAAQ,IAAI,CAAC;AACf;AAEA,MAAM,UAAU;IAAC;IAAiB;CAAqB;AAEvD,KAAK,MAAM,UAAU,QAAS;IAC5B,IAAI;QACF,KAAK,MAAM,CAAC,KAAK,MAAM,IAAI,OAAO,OAAO,CAAC,QAAS;YACjD,MAAM,OAAO,UAAU,KAAK,IAAI;YAChC,IAAI,CAAC,MAAM;YACX,IAAI,MAAM,OAAO,CAAC,QAAQ;gBACxB,MAAM,YAAY,MACf,GAAG,CAAC,CAAC;oBACJ,IAAI,OAAO,SAAS,UAAU,OAAO;oBACrC,IAAI,QAAQ,OAAO,SAAS,YAAY,WAAW,MAAM;wBACvD,MAAM,QAAQ,AAAC,KAA6B,KAAK;wBACjD,OAAO,OAAO,UAAU,WAAW,QAAQ;oBAC7C;oBACA,OAAO;gBACT,GACC,MAAM,CAAC,CAAC,IAAmB,CAAC,CAAC;gBAEhC,MAAM,SAAS,MAAM,IAAI,CAAC,IAAI,IAAI;gBAClC,IAAI,OAAO,MAAM,EAAE,IAAI,GAAG,CAAC,MAAM;YACnC;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,IAAI,CAAC,sCAAsC;IACrD;AACF;AAEO,SAAS,mBAAmB,WAAmB;IACpD,IAAI;QACF,MAAM,OAAO,UAAU,aAAa,IAAI;QACxC,IAAI,CAAC,MAAM,OAAO,EAAE;QACpB,OAAO,IAAI,GAAG,CAAC,SAAS,EAAE;IAC5B,EAAE,OAAO,OAAO;QACd,QAAQ,IAAI,CAAC,mCAAmC;QAChD,OAAO,EAAE;IACX;AACF"}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ameli/Documents/studia/projekt/ShareWay/frontend/lib/destinationImageCatalog.ts"],"sourcesContent":["import type { TripAccentPreset } from \"@/lib/types/trip\";\r\nimport { getPrebakedQueries } from \"@/lib/prebakedQueries\";\r\n\r\ntype LearnedDestination = {\r\n  queries: string[];\r\n  imageUrl: string;\r\n};\r\n\r\nconst tokenDictionary: Record<string, string> = {\r\n  polska: \"Poland\",\r\n  niemcy: \"Germany\",\r\n  hiszpania: \"Spain\",\r\n  francja: \"France\",\r\n  wlochy: \"Italy\",\r\n  wloch: \"Italy\",\r\n  chorwacja: \"Croatia\",\r\n  czechy: \"Czech Republic\",\r\n  norwegia: \"Norway\",\r\n  islandia: \"Iceland\",\r\n  maroko: \"Morocco\",\r\n  indonezja: \"Indonesia\",\r\n  \"stany zjednoczone\": \"USA\",\r\n  usa: \"USA\",\r\n  \"nowy jork\": \"New York\",\r\n  berlin: \"Berlin\",\r\n  barcelona: \"Barcelona\",\r\n  \"hiszpania barcelona\": \"Barcelona\",\r\n  paryz: \"Paris\",\r\n  paryzu: \"Paris\",\r\n  praga: \"Prague\",\r\n  pragi: \"Prague\",\r\n  sopot: \"Sopot\",\r\n  gdansk: \"Gdansk\",\r\n  baltyk: \"Baltic sea\",\r\n  \"morze baltyckie\": \"Baltic sea\",\r\n  zakopane: \"Zakopane\",\r\n  tatry: \"Tatra Mountains\",\r\n  stolowe: \"Table Mountains\",\r\n  alpy: \"Alps\",\r\n  zermatt: \"Zermatt\",\r\n  bali: \"Bali\",\r\n  merzouga: \"Merzouga\",\r\n  sahara: \"Sahara desert\",\r\n  podlasie: \"Podlasie\",\r\n  mazury: \"Masurian lakes\",\r\n  mazur: \"Masurian lakes\",\r\n  adriatyk: \"Adriatic sea\",\r\n  nyc: \"New York\",\r\n  santorini: \"Santorini\",\r\n  grecja: \"Greece\",\r\n  greece: \"Greece\",\r\n  toskania: \"Tuscany\",\r\n  tuscany: \"Tuscany\",\r\n  lisbon: \"Lisbon\",\r\n  lisbona: \"Lisbon\",\r\n  porto: \"Porto\",\r\n  warszawa: \"Warsaw\",\r\n  warsaw: \"Warsaw\",\r\n  krakow: \"Krakow\",\r\n  krakowa: \"Krakow\",\r\n  wroclaw: \"Wroclaw\",\r\n  wrocław: \"Wroclaw\",\r\n  malta: \"Malta\",\r\n  tenerife: \"Tenerife\",\r\n  kanary: \"Canary Islands\",\r\n  madeira: \"Madeira\",\r\n  bieszczady: \"Bieszczady Mountains\",\r\n  split: \"Split\",\r\n  plazowanie: \"beach\",\r\n  \"plazowanie.\": \"beach\",\r\n  \"plazowanie,\": \"beach\",\r\n  plaze: \"beaches\",\r\n  plaza: \"beach\",\r\n  plaz: \"beach\",\r\n  morze: \"sea\",\r\n  \"surf camp\": \"surf camp\",\r\n  surf: \"surf\",\r\n  surfing: \"surfing\",\r\n};\r\n\r\nconst learnedDestinations = new Map<string, LearnedDestination>();\r\n\r\nexport function normalizeToAsciiLower(text: string) {\r\n  return text\r\n    .normalize(\"NFD\")\r\n    .replace(/[\\u0300-\\u036f]/g, \"\")\r\n    .toLowerCase();\r\n}\r\n\r\nfunction normalizeKey(text: string) {\r\n  return normalizeToAsciiLower(text).trim();\r\n}\r\n\r\nfunction escapeRegex(value: string) {\r\n  return value.replace(/[.*+?^${}()|[\\]\\\\]/g, \"\\\\$&\");\r\n}\r\n\r\nexport function translateToEnglishTokens(destination: string) {\r\n  const normalized = normalizeToAsciiLower(destination);\r\n  if (!normalized) return \"\";\r\n\r\n  let translated = normalized;\r\n  for (const [token, replacement] of Object.entries(tokenDictionary)) {\r\n    translated = translated.replace(\r\n      new RegExp(`\\\\b${escapeRegex(token)}\\\\b`, \"g\"),\r\n      replacement\r\n    );\r\n  }\r\n\r\n  return translated.replace(/\\s+/g, \" \").trim();\r\n}\r\n\r\nexport type LocationDetails = {\r\n  city: string;\r\n  country: string;\r\n  englishCity: string;\r\n  englishCountry: string;\r\n  combined: string;\r\n  englishCombined: string;\r\n  normalized: string;\r\n};\r\n\r\nexport function getLocationDetails(destination: string): LocationDetails {\r\n  const normalized = normalizeToAsciiLower(destination || \"\");\r\n  const segments = destination\r\n    .split(\",\")\r\n    .map((segment) => segment.trim())\r\n    .filter(Boolean);\r\n  const city = segments[0] || \"\";\r\n  const country = segments.slice(1).join(\" \").trim();\r\n  const englishCity = city ? translateToEnglishTokens(city) : \"\";\r\n  const englishCountry = country ? translateToEnglishTokens(country) : \"\";\r\n  const combined = [city, country].filter(Boolean).join(\" \").trim();\r\n  const englishCombined = [englishCity, englishCountry]\r\n    .filter(Boolean)\r\n    .join(\" \")\r\n    .trim();\r\n\r\n  return {\r\n    city,\r\n    country,\r\n    englishCity,\r\n    englishCountry,\r\n    combined,\r\n    englishCombined,\r\n    normalized,\r\n  };\r\n}\r\n\r\nfunction buildLocationPriorityQueries(\r\n  location: LocationDetails,\r\n  presetHints: string[]\r\n) {\r\n  const queries: string[] = [];\r\n  const {\r\n    city,\r\n    country,\r\n    englishCity,\r\n    englishCountry,\r\n    combined,\r\n    englishCombined,\r\n  } = location;\r\n  const addQuery = (value?: string) => {\r\n    if (value) queries.push(value.trim());\r\n  };\r\n\r\n  addQuery(englishCombined);\r\n  if (\r\n    englishCountry &&\r\n    englishCity &&\r\n    `${englishCountry} ${englishCity}`.trim() !== englishCombined\r\n  ) {\r\n    addQuery(`${englishCountry} ${englishCity}`);\r\n  }\r\n  addQuery(combined);\r\n  if (country && city) addQuery(`${country} ${city}`);\r\n  addQuery(englishCity && country ? `${englishCity} ${country}` : \"\");\r\n  addQuery(englishCountry && city ? `${englishCountry} ${city}` : \"\");\r\n\r\n  const firstHint = presetHints[0];\r\n  if (firstHint) {\r\n    [englishCity, city].forEach((value) => {\r\n      if (value) addQuery(`${value} ${firstHint}`);\r\n    });\r\n    [englishCountry, country].forEach((value) => {\r\n      if (value) addQuery(`${value} ${firstHint}`);\r\n    });\r\n  }\r\n\r\n  [englishCity, englishCountry, city, country].forEach(addQuery);\r\n  const landscapeHints = [\"landscape\", \"scenic view\", \"aerial view\", \"sunrise\", \"sunset\"];\r\n  landscapeHints.forEach((hint) => {\r\n    [englishCity, city, englishCountry, country]\r\n      .filter(Boolean)\r\n      .forEach((value) => addQuery(`${value} ${hint}`));\r\n  });\r\n  return queries.filter(Boolean);\r\n}\r\n\r\nexport function buildDestinationQueries(\r\n  destination: string,\r\n  preset: TripAccentPreset = \"neutral\"\r\n) {\r\n  const translated = translateToEnglishTokens(destination || \"\");\r\n  const locationDetails = getLocationDetails(destination);\r\n  const parts = translated\r\n    .split(\",\")\r\n    .map((p) => p.trim())\r\n    .filter(Boolean);\r\n  const primary = parts[0] || translated || destination.trim() || \"\";\r\n  const secondary = parts.length > 1 ? parts[1] : \"\";\r\n\r\n  const extraFromPrebaked = getPrebakedQueries(destination);\r\n\r\n  const learned = learnedDestinations.get(normalizeKey(destination));\r\n  const extraFromLearned = learned?.queries ?? [];\r\n\r\n  const presetHints =\r\n    preset === \"mountains\"\r\n      ? [\"mountains\", \"landscape\", \"ridge\", \"alps\"]\r\n      : preset === \"beach\" || preset === \"tropical\"\r\n      ? [\"beach\", \"sea\", \"coast\", \"sunset\"]\r\n      : preset === \"city\"\r\n      ? [\"city\", \"skyline\", \"old town\"]\r\n      : preset === \"lake\"\r\n      ? [\"lake\", \"lakes\", \"water\", \"sunset\"]\r\n      : preset === \"winter\"\r\n      ? [\"winter\", \"snow\", \"alps\"]\r\n      : preset === \"countryside\"\r\n      ? [\"countryside\", \"fields\", \"village\"]\r\n      : preset === \"desert\"\r\n      ? [\"desert\", \"sand\"]\r\n      : preset === \"adventure\"\r\n      ? [\"outdoor\", \"adventure\"]\r\n      : [];\r\n\r\n  const locationQueries = buildLocationPriorityQueries(\r\n    locationDetails,\r\n    presetHints\r\n  );\r\n\r\n  const contextual: string[] = [];\r\n  if (primary && secondary) {\r\n    contextual.push(`${primary} ${secondary}`);\r\n    contextual.push(`${primary} ${secondary} ${presetHints[0] ?? \"\"}`.trim());\r\n  }\r\n\r\n  const descriptiveCombos = [\r\n    `${primary} ${secondary} sunset`.trim(),\r\n    `${primary} ${secondary} aerial view`.trim(),\r\n    `${primary} old town night`.trim(),\r\n    `${primary} skyline night lights`.trim(),\r\n    `${primary} coastline turquoise water`.trim(),\r\n  ];\r\n\r\n  const baseQueries = [\r\n    primary,\r\n    `${primary} travel`,\r\n    `${primary} landscape`,\r\n    `${primary} nature`,\r\n    `${primary} best view`,\r\n  ];\r\n\r\n  const withPresetHints = presetHints.map((hint) => `${primary} ${hint}`);\r\n\r\n  const all = [\r\n    ...locationQueries,\r\n    ...extraFromPrebaked,\r\n    ...extraFromLearned,\r\n    ...contextual,\r\n    ...descriptiveCombos,\r\n    ...baseQueries,\r\n    ...withPresetHints,\r\n  ];\r\n\r\n  return Array.from(new Set(all.filter((v) => v && v.trim().length > 0)));\r\n}\r\n\r\nexport function learnDestination(\r\n  destination: string,\r\n  queries: string[],\r\n  imageUrl: string\r\n) {\r\n  if (!destination || !imageUrl) return;\r\n  const key = normalizeKey(destination);\r\n  if (!key || learnedDestinations.has(key)) return;\r\n\r\n  learnedDestinations.set(key, { queries, imageUrl });\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 386, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ameli/Documents/studia/projekt/ShareWay/frontend/app/api/destination-image/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport type { TripAccentPreset } from \"@/lib/types/trip\";\r\nimport {\r\n  buildDestinationQueries,\r\n  getLocationDetails,\r\n  learnDestination,\r\n  normalizeToAsciiLower,\r\n  translateToEnglishTokens,\r\n} from \"@/lib/destinationImageCatalog\";\r\n\r\nexport const dynamic = \"force-dynamic\";\r\nexport const revalidate = 0;\r\n\r\nconst PEXELS_API_KEY = process.env.PEXELS_API_KEY || \"\";\r\nconst DISABLE_PEXELS =\r\n  process.env.DISABLE_PEXELS === \"1\" || process.env.DISABLE_PEXELS === \"true\";\r\nconst EMBEDDING_RERANKER_URL = process.env.EMBEDDING_RERANKER_URL?.trim() || \"\";\r\n\r\ntype CacheEntry = { urls: string[]; index: number; source: string };\r\nconst memoryCache = new Map<string, CacheEntry>();\r\nconst validPresets: TripAccentPreset[] = [\r\n  \"mountains\",\r\n  \"beach\",\r\n  \"city\",\r\n  \"neutral\",\r\n  \"desert\",\r\n  \"tropical\",\r\n  \"winter\",\r\n  \"lake\",\r\n  \"countryside\",\r\n  \"adventure\",\r\n];\r\n\r\nexport async function GET(req: Request) {\r\n  const { searchParams } = new URL(req.url);\r\n  const reset = searchParams.get(\"reset\");\r\n  const stable =\r\n    searchParams.get(\"stable\") === \"1\" || searchParams.get(\"stable\") === \"true\";\r\n  if (reset === \"1\" || reset === \"true\") {\r\n    memoryCache.clear();\r\n    return NextResponse.json({ cleared: true }, { status: 200 });\r\n  }\r\n\r\n  const qRaw = searchParams.get(\"q\") || \"\";\r\n  const presetParam = searchParams.get(\"preset\");\r\n  const preset: TripAccentPreset = isTripAccentPreset(presetParam)\r\n    ? presetParam\r\n    : \"neutral\";\r\n\r\n  const queries = buildDestinationQueries(qRaw, preset);\r\n  const cacheKey = queries[0] || qRaw || preset;\r\n\r\n  const cached = memoryCache.get(cacheKey);\r\n  if (cached && cached.urls.length) {\r\n    const nextIndex = stable\r\n      ? cached.index\r\n      : cached.urls.length > 1\r\n      ? (cached.index + 1) % cached.urls.length\r\n      : cached.index;\r\n    if (!stable) {\r\n      cached.index = nextIndex;\r\n      memoryCache.set(cacheKey, cached);\r\n    }\r\n    return NextResponse.json(\r\n      {\r\n        url: cached.urls[Math.min(nextIndex || 0, cached.urls.length - 1)],\r\n        source: cached.source || \"memory-cache\",\r\n      },\r\n      { status: 200 }\r\n    );\r\n  }\r\n\r\n  // If we already know the image for this destination, reuse it and avoid any fetch.\r\n  if (DISABLE_PEXELS || !PEXELS_API_KEY.trim()) {\r\n    return NextResponse.json(\r\n      {\r\n        error: \"Image retrieval disabled or missing PEXELS_API_KEY\",\r\n      },\r\n      { status: 503 }\r\n    );\r\n  }\r\n\r\n  let pexelsResult: string[] | null = null;\r\n  let usedQuery: string | null = null;\r\n  let source: \"pexels-primary\" | \"pexels-fallback\" | null = null;\r\n\r\n  for (const query of queries) {\r\n    const tokens = buildScoringTokens(qRaw, query, preset);\r\n    const result = await fetchPexelsCandidates(query, tokens, qRaw);\r\n    if (result.length) {\r\n      pexelsResult = result;\r\n      usedQuery = query;\r\n      source = \"pexels-primary\";\r\n      break;\r\n    }\r\n  }\r\n\r\n  // Broaden the search to similar/related images if exact destination returns nothing.\r\n  if (!pexelsResult) {\r\n    for (const query of buildFallbackPexelsQueries(qRaw, preset, queries)) {\r\n      const tokens = buildScoringTokens(qRaw, query, preset);\r\n      const result = await fetchPexelsCandidates(query, tokens, qRaw);\r\n      if (result.length) {\r\n        pexelsResult = result;\r\n        usedQuery = query;\r\n        source = \"pexels-fallback\";\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (pexelsResult?.length) {\r\n    const unique = Array.from(new Set(pexelsResult));\r\n    const picked = unique[0];\r\n\r\n    memoryCache.set(cacheKey, {\r\n      urls: unique,\r\n      index: 0,\r\n      source: source ?? \"pexels\",\r\n    });\r\n\r\n    learnDestination(qRaw, usedQuery ? [usedQuery] : queries, picked);\r\n\r\n    return NextResponse.json(\r\n      { url: picked, source: source ?? \"pexels\" },\r\n      { status: 200 }\r\n    );\r\n  }\r\n\r\n  return NextResponse.json(\r\n    {\r\n      error: \"No image found from Pexels\",\r\n    },\r\n    { status: 404 }\r\n  );\r\n}\r\n\r\nfunction isTripAccentPreset(value: string | null): value is TripAccentPreset {\r\n  return value !== null && validPresets.includes(value as TripAccentPreset);\r\n}\r\n\r\nasync function fetchPexelsCandidates(\r\n  query: string,\r\n  tokens: string[],\r\n  prompt: string\r\n) {\r\n  if (!PEXELS_API_KEY || !query.trim()) return [];\r\n\r\n  const searchParams = new URLSearchParams({\r\n    query,\r\n    per_page: \"30\",\r\n    orientation: \"landscape\",\r\n    page: \"1\",\r\n  });\r\n\r\n  const res = await fetch(\r\n    `https://api.pexels.com/v1/search?${searchParams.toString()}`,\r\n    {\r\n      headers: { Authorization: PEXELS_API_KEY },\r\n      cache: \"no-store\",\r\n    }\r\n  ).catch(() => null);\r\n\r\n  if (!res || !res.ok) return [];\r\n\r\n  const data = (await res.json()) as {\r\n    photos?: {\r\n      src?: { landscape?: string; large2x?: string };\r\n      alt?: string;\r\n    }[];\r\n  };\r\n\r\n  const list = data?.photos ?? [];\r\n  if (!list.length) return [];\r\n\r\n  const rerankedTop = await pickByEmbedding(list, prompt);\r\n  const tokenSorted = sortByTokens(list, tokens);\r\n\r\n  const ordered = rerankedTop\r\n    ? [rerankedTop, ...tokenSorted.filter((p) => p !== rerankedTop)]\r\n    : tokenSorted;\r\n\r\n  return ordered\r\n    .slice(0, 12)\r\n    .map((photo) => photo.src?.landscape || photo.src?.large2x || \"\")\r\n    .filter(Boolean);\r\n}\r\n\r\nfunction buildScoringTokens(\r\n  destination: string,\r\n  query: string,\r\n  preset: TripAccentPreset\r\n) {\r\n  const translated = translateToEnglishTokens(destination || \"\");\r\n  const destWords = normalizeToAsciiLower(translated)\r\n    .split(/\\s|,/)\r\n    .filter(Boolean);\r\n  const queryWords = normalizeToAsciiLower(query).split(/\\s|,/).filter(Boolean);\r\n\r\n  const presetHints =\r\n    preset === \"mountains\"\r\n      ? [\"mountains\", \"landscape\"]\r\n      : preset === \"beach\" || preset === \"tropical\"\r\n      ? [\"beach\", \"sea\", \"coast\"]\r\n      : preset === \"city\"\r\n      ? [\"city\", \"skyline\"]\r\n      : preset === \"lake\"\r\n      ? [\"lake\", \"water\"]\r\n      : preset === \"winter\"\r\n      ? [\"winter\", \"snow\"]\r\n      : preset === \"countryside\"\r\n      ? [\"countryside\", \"fields\", \"village\"]\r\n      : preset === \"desert\"\r\n      ? [\"desert\", \"sand\"]\r\n      : preset === \"adventure\"\r\n      ? [\"outdoor\", \"adventure\"]\r\n      : [];\r\n\r\n  return Array.from(\r\n    new Set([...destWords, ...queryWords, ...presetHints].filter(Boolean))\r\n  );\r\n}\r\n\r\nfunction buildFallbackPexelsQueries(\r\n  destination: string,\r\n  preset: TripAccentPreset,\r\n  exclude: string[] = []\r\n) {\r\n  const location = getLocationDetails(destination);\r\n  const {\r\n    city,\r\n    country,\r\n    englishCity,\r\n    englishCountry,\r\n    combined,\r\n    englishCombined,\r\n    normalized,\r\n  } = location;\r\n\r\n  const genericByPreset: Record<TripAccentPreset, string[]> = {\r\n    mountains: [\"mountain landscape sunrise\", \"alpine mountains view\"],\r\n    beach: [\"tropical beach sunset\", \"coastline turquoise water\"],\r\n    city: [\"modern city skyline night\", \"historic city old town\"],\r\n    neutral: [\"beautiful travel landscape\", \"travel destination aerial\"],\r\n    desert: [\"desert sand dunes sunset\"],\r\n    tropical: [\"tropical island beach aerial\"],\r\n    winter: [\"snowy mountain landscape winter\"],\r\n    lake: [\"lake with mountains reflection\"],\r\n    countryside: [\"countryside fields sunrise\"],\r\n    adventure: [\"hiking trail mountain adventure\"],\r\n  };\r\n\r\n  const presetFallbacks = genericByPreset[preset] ?? genericByPreset.neutral;\r\n  const presetHints =\r\n    preset === \"mountains\"\r\n      ? [\"mountains\", \"ridge\"]\r\n      : preset === \"beach\" || preset === \"tropical\"\r\n      ? [\"beach\", \"sea\", \"coast\"]\r\n      : preset === \"city\"\r\n      ? [\"city skyline\", \"old town\"]\r\n      : preset === \"lake\"\r\n      ? [\"lake\", \"water\"]\r\n      : preset === \"winter\"\r\n      ? [\"winter\", \"snow\"]\r\n      : preset === \"countryside\"\r\n      ? [\"countryside\", \"fields\"]\r\n      : preset === \"desert\"\r\n      ? [\"desert\", \"dunes\"]\r\n      : preset === \"adventure\"\r\n      ? [\"outdoor\", \"adventure\"]\r\n      : [\"travel\"];\r\n\r\n  const joinSegments = (a?: string, b?: string) =>\r\n    a && b ? `${a} ${b}`.trim() : \"\";\r\n\r\n  const withDestination = [\r\n    englishCombined,\r\n    combined,\r\n    joinSegments(city, country),\r\n    joinSegments(country, city),\r\n    joinSegments(englishCity, englishCountry),\r\n    joinSegments(englishCountry, englishCity),\r\n    city ? `${city} ${presetHints[0] ?? \"\"}`.trim() : \"\",\r\n    englishCity ? `${englishCity} ${presetHints[0] ?? \"\"}`.trim() : \"\",\r\n    city ? `${city} scenic view` : \"\",\r\n    englishCity ? `${englishCity} scenic view` : \"\",\r\n  ].filter(Boolean);\r\n\r\n  const withCountryHints = [\r\n    country ? `${country} ${presetHints[0] ?? \"\"}`.trim() : \"\",\r\n    englishCountry ? `${englishCountry} ${presetHints[0] ?? \"\"}`.trim() : \"\",\r\n    country ? `${country} scenic view` : \"\",\r\n    englishCountry ? `${englishCountry} scenic view` : \"\",\r\n  ].filter(Boolean);\r\n\r\n  const baseCombined =\r\n    englishCombined || combined || normalized || joinSegments(city, country);\r\n\r\n  const withCombinedHints = baseCombined\r\n    ? [\r\n        `${baseCombined} ${presetHints[0] ?? \"\"}`.trim(),\r\n        `${baseCombined} ${presetHints.join(\" \")}`.trim(),\r\n        `${baseCombined} travel`,\r\n        `${baseCombined} landscape`,\r\n        `${baseCombined} aerial view`,\r\n      ]\r\n    : [];\r\n\r\n  const withSingles = [englishCity, englishCountry, city, country].filter(Boolean);\r\n\r\n  const all = [\r\n    ...withDestination,\r\n    ...withCombinedHints,\r\n    ...withSingles,\r\n    ...withCountryHints,\r\n    ...presetFallbacks,\r\n    \"travel destination landscape\",\r\n  ];\r\n  const excludeSet = new Set(exclude.map((q) => q.toLowerCase().trim()));\r\n\r\n  return Array.from(\r\n    new Set(\r\n      all\r\n        .map((q) => q.trim())\r\n        .filter((q) => q && !excludeSet.has(q.toLowerCase()))\r\n    )\r\n  );\r\n}\r\n\r\nfunction pickBestByTokens(\r\n  photos: { src?: { landscape?: string; large2x?: string }; alt?: string }[],\r\n  tokens: string[] = []\r\n) {\r\n  if (!photos.length) return null;\r\n  const fallback =\r\n    photos[Math.floor(Math.random() * Math.max(photos.length, 1))] || null;\r\n\r\n  const scored = photos\r\n    .map((photo) => {\r\n      const alt = normalizeToAsciiLower(photo.alt || \"\");\r\n      let score = 0;\r\n      for (const token of tokens) {\r\n        if (token && alt.includes(token)) score += 3;\r\n      }\r\n      score += alt.length * 0.01;\r\n      return { photo, score };\r\n    })\r\n    .sort((a, b) => b.score - a.score);\r\n\r\n  const best = scored[0];\r\n  if (!best || best.score === 0) return fallback;\r\n  return best.photo;\r\n}\r\n\r\nfunction sortByTokens(\r\n  photos: { src?: { landscape?: string; large2x?: string }; alt?: string }[],\r\n  tokens: string[] = []\r\n) {\r\n  return photos\r\n    .map((photo) => {\r\n      const alt = normalizeToAsciiLower(photo.alt || \"\");\r\n      let score = 0;\r\n      for (const token of tokens) {\r\n        if (token && alt.includes(token)) score += 3;\r\n      }\r\n      score += alt.length * 0.01;\r\n      return { photo, score };\r\n    })\r\n    .sort((a, b) => b.score - a.score)\r\n    .map((p) => p.photo);\r\n}\r\n\r\nasync function pickByEmbedding(\r\n  photos: {\r\n    src?: { landscape?: string; large2x?: string };\r\n    alt?: string;\r\n  }[],\r\n  prompt: string\r\n) {\r\n  if (!EMBEDDING_RERANKER_URL) return null;\r\n  const candidates = photos\r\n    .map((photo, index) => ({\r\n      index,\r\n      url: photo.src?.landscape || photo.src?.large2x || \"\",\r\n      alt: photo.alt || \"\",\r\n    }))\r\n    .filter((c) => !!c.url);\r\n\r\n  if (!candidates.length) return null;\r\n\r\n  try {\r\n    const res = await fetch(EMBEDDING_RERANKER_URL, {\r\n      method: \"POST\",\r\n      headers: { \"Content-Type\": \"application/json\" },\r\n      body: JSON.stringify({ prompt, candidates }),\r\n      cache: \"no-store\",\r\n    });\r\n    if (!res.ok) return null;\r\n    const data = (await res.json()) as {\r\n      indices?: number[];\r\n      scores?: number[];\r\n    };\r\n\r\n    const idx =\r\n      (data.indices && data.indices[0]) ??\r\n      (Array.isArray(data.scores)\r\n        ? data.scores\r\n            .map((s, i) => ({ s, i }))\r\n            .sort((a, b) => (b.s ?? 0) - (a.s ?? 0))[0]?.i\r\n        : null);\r\n\r\n    if (idx == null || idx < 0 || idx >= photos.length) return null;\r\n    return photos[idx];\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}